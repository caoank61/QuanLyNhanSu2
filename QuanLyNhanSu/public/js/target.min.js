//Slide bay bay bay
$(document).ready(function () {

    var sync1 = $("#sync1");
    var sync2 = $("#sync2");

    sync1.owlCarousel({
        autoPlay: 3000, //auto chay slider sau 1s
        singleItem: true,
        slideSpeed: 1000,
        navigation: true,
        pagination: false,
        afterAction: syncPosition,
        responsiveRefreshRate: 200,
    });

    sync2.owlCarousel({
        items: 5,
        itemsDesktop: [1199, 10],
        itemsDesktopSmall: [979, 10],
        itemsTablet: [768, 8],
        itemsMobile: [479, 4],
        pagination: false,
        responsiveRefreshRate: 100,
        afterInit: function (el) {
            el.find(".owl-item").eq(0).addClass("synced");
        }
    });

    function syncPosition(el) {
        var current = this.currentItem;
        $("#sync2")
            .find(".owl-item")
            .removeClass("synced")
            .eq(current)
            .addClass("synced")
        if ($("#sync2").data("owlCarousel") !== undefined) {
            center(current)
        }
    }

    $("#sync2").on("click", ".owl-item", function (e) {
        e.preventDefault();
        var number = $(this).data("owlItem");
        sync1.trigger("owl.goTo", number);
    });

    function center(number) {
        var sync2visible = sync2.data("owlCarousel").owl.visibleItems;
        var num = number;
        var found = false;
        for (var i in sync2visible) {
            if (num === sync2visible[i]) {
                var found = true;
            }
        }

        if (found === false) {
            if (num > sync2visible[sync2visible.length - 1]) {
                sync2.trigger("owl.goTo", num - sync2visible.length + 2)
            } else {
                if (num - 1 === -1) {
                    num = 0;
                }
                sync2.trigger("owl.goTo", num);
            }
        } else if (num === sync2visible[sync2visible.length - 1]) {
            sync2.trigger("owl.goTo", sync2visible[1])
        } else if (num === sync2visible[0]) {
            sync2.trigger("owl.goTo", num - 1)
        }

    }

});


// Item p
$(document).ready(function () {

    $("#owl-wrap").owlCarousel({
        autoPlay: 5000,
        navigation: true
    });

});
$(document).ready(function () {

    $("#owl-news").owlCarousel({
        autoPlay: 5000,
        navigation: false, // Show next and prev buttons
        slideSpeed: 300,
        paginationSpeed: 400,
        singleItem: true

        // "singleItem:true" is a shortcut for:
        // items : 1, 
        // itemsDesktop : false,
        // itemsDesktopSmall : false,
        // itemsTablet: false,
        // itemsMobile : false

    });

});
$(document).ready(function () {
    $("#new-product").owlCarousel({
        autoPlay: 5000,
        navigation: true
    });

});
$('#modal').modal({ backdrop: 'static', keyboard: false })
$(document).ready(function () {
    $('.dk-lg').click(function () {
        $('#exampleModal1').modal('hide');
        $('#exampleModal1').on('hidden.bs.modal', function () {
            $(this).find("input").val('').end();
        });
    })
    $('.dn-lg').click(function () {
        $('#exampleModal').modal('hide');
        $('#exampleModal').on('hidden.bs.modal', function () {
            $(this).find("input").val('').end();
        });
    })

})
// 
$(function () {
    $('.etd').on('keyup', function () {
        const num = parseInt($('.etd').val());
        if (num > 99) {
            parseInt($('.etd').val('99'));
        } else if ($('.etd').val() == 0 || $('.etd').val() == '') {
            parseInt($('.etd').val('1'));
        }
    });
})


$(document).ready(function () {
    $('.list').click(function (e) {
        e.preventDefault();
        $('.list .i').removeClass('list-icon');
        $('.list .i').addClass('list-icon-active');
        $('.grid .i').removeClass('grid-icon-active');
        $('.grid .i').addClass('grid-icon');
        $('.product-category .item').addClass('grid-item');
        $('.product-category .item').removeClass('nghiep-item');
    });
    $('.grid').click(function (e) {
        e.preventDefault();
        $('.grid .i').removeClass('grid-icon');
        $('.grid .i').addClass('grid-icon-active');
        $('.list .i').removeClass('list-icon-active');
        $('.list .i').addClass('list-icon');
        $('.product-category .item').removeClass('grid-item');
        $('.product-category .item').addClass('nghiep-item');
    });
});

// Back to top
$(function () {
    $(window).scroll(function () {
        if ($(this).scrollTop() != 0) {
            $('#bttop').fadeIn();
        }
        else {
            $('#bttop').fadeOut();
        }
    });
    $('#bttop').click(function () {
        $('body,html').animate(
            { scrollTop: 0 }, 800);
    });
});


$(function () {
    $('#btn_login_c').off('click').on('click',function (e) {
        e.preventDefault();
        
        const User = $('input[name=Name]').val().trim();
        const Password = $('input[name=Password]').val().trim();

        console.log(User, Password)
        if (User == '') {
            $('#nameHelp').html('Vui lòng nhập Email hoặc Số điện thoại!');
            return false;
        }
        else if (Password == '') {
            $('#passHelp').html('Vui lòng nhập mật khẩu!');
            return false;
        }

        $.ajax("/account/userlogin", {
            type: 'POST',
            data: { User: User, Password: Password },
            dataType: 'json',
            success: function (s) {
                if (s.s == 1) {
                    $('#nameHelp').text('Thông tin tài khoản không chính xác');
                    return;
                } else if (s.s == 2) {
                    $('#passHelp').text('Mật khẩu không chính xác');
                    return;
                } else if (s.s == 0) {
                    window.location.reload();
                    return;
                }
            }
        });
    });
});
$(function () {
    $('.shop input').click(function () {
        $('#nameHelp').html('');
        $('#passHelp').html('');
    })
})
function WIYN() {
    Swal.fire({
        icon: 'warning',
        title: "Bạn cần đăng nhập để tiếp tục!",
        showCancelButton: true,
        confirmButtonColor: '#4a90e2',
        cancelButtonColor: '',
        confirmButtonText: 'Đăng nhập'
    }).then((result) => {
        if (result.value) {
            $('#exampleModal1').modal('show');
        }
    })
}
function AwToast(icon, content, timer) {
    Swal.fire({
        icon: icon,
        title: content,
        timer: timer
    })
}
// Notification FE
$(window).on('load', function () {
    const mgs_type = $('input[name=u_mgs_type]').val();
    const msg = $('input[name=u_mgs]').val();
    if (mgs_type != '' && msg != '') {
        switch (mgs_type) {
            case 'success':
                AwToast(mgs_type, msg, 10000)
                break;
            case 'warning':
                AwToast(mgs_type, msg, 10000)
                break;
            case 'danger':
                AwToast(mgs_type, msg, 10000)
                break;
        }
    }
});

$(function () {
    $('.notready').click(function (e) {
        e.preventDefault();
        Swal.fire({
            icon: 'warning',
            title: 'Chức năng chưa sẵn sàng!',
            timer: 5000
        })
    })
})

function validateForm() {
    if ($('#email').val() == null || $('#email').val() == '') {
        Swal.fire('Vui lòng nhập email!');
        return false;
    } else if (($('#address').val().trim() == null || $('#address').val().trim() == '')) {
        Swal.fire('Vui lòng nhập địa chỉ nhân hàng!');
        return false;
    }
    return true;
}

$(document).ready(function () {
    $('.checkAuth').click(function (e) {
        e.preventDefault();
        $.ajax({
            url: "/cart/checkauth",
            type: 'POST',
            success: function (response) {
                if (response == 1) {
                    window.location.href = "thanh-toan";
                } else {
                    WIYN();
                }
            }
        });
    });
});
$(function () {
    $('#buy-btn').off('click').on('click', function (e) {
        e.preventDefault();
        var count = $('input[name="count-xyz"]').val() || 0;
        var m = $('.etd').val() || 0;
        var iCount = parseInt(count);
        var iM = parseInt(m);
        if (iM > iCount) {
            alert("Số lượng vượt quá số lượng cho phép. Vui lòng mua với số lượng ít hơn!")
        }
        else {
            $.ajax({
                url: 'cart/add',
                type: 'POST',
                data: {
                    pid: $(this).data('id'),
                    qty: $('.etd').val()
                },
                dataType: 'json',
                success: function (response) {
                    debugger;
                    if (response.result == 1) {
                        $('.slc').text(parseInt($('.slc').text()) + 1);
                        $('.list-cart').load('module/mitc');
                        AwToast('success', 'Đã thêm sản phẩm vào giỏ hàng');

                    } else if (response.result == 2) {
                        $('.list-cart').load('module/mitc');
                        AwToast('success', 'Đã cập nhật lại số lượng sản phẩm trong giỏ hàng');
                    }
                    else if (response.result == 3) {
                        alert('Số lượng sản phẩm không đủ.');
                    }
                }
            })
        }
    })
})
$(function () {
    $('.m-remove-one').off('click').on('click', function (e) {
        e.preventDefault();

        $.ajax({
            url: 'cart/update',
            type: 'POST',
            data: {
                pid: $(this).data('id'),
                option: 'remove'
            },
            dataType: 'json',
            success: function (response) {
                if (response == 3) {
                    $('.slc').text(parseInt($('.slc').text()) - 1);
                    $('.list-cart').load('module/mitc');
                    $('#checkout').load('module/icart');
                }
            }
        })
    })
})


//$(function () {
//    $('.remove-one').bind('click', function (e) {
//        e.preventDefault();
//        $.ajax({
//            url: 'cart/update',
//            type: 'POST',
//            data: {
//                pid: $(this).data('id'),
//                option: 'remove'
//            },
//            dataType: 'json',
//            success: function (response) {
//                if (response.result == 1) {
//                    $('.slc').text(parseInt($('.slc').text()) - 1);
//                    $('.list-cart').load('module/mitc');
//                    $('#checkout').load('module/icart');
//                    AwToast('info', 'Đã xóa sản phẩm khỏi giỏ hàng!', 5000);
//                    return;
//                }
//                AwToast('danger', '404!', 5000);
//            }
//        })
//        $(this).unbind('click');
//    })
//})

//$(function () {
//    $('#checkout').bind('click', function (e) {
//        $.ajax({
//            url: 'cart/Updaterrrr',
//            type: 'POST',
//            data: {
//                pid: $(this).data('id'),
//                option: $(this).data('options'),
//                qty: $('input[name=etd]').val()
//            },
//            dataType: 'json',
//            success: function (response) {
//                switch (response.result) {
//                    case 4:
//                        $('.list-cart').load('module/mitc');
//                        $('#checkout').load('module/icart');
//                        AwToast('success', 'Đã cập nhật lại sô lượng trong giỏ hàng!', 5000);
//                        break;
//                }
//            }
//        })
//        $(this).unbind('click');
//    });
//});


$(function () {
    $('.update').off('click').on('click', function (e) {
        e.preventDefault();

        $.ajax('cart/update', {

            type: 'POST',
            data: { pid: $(this).data('id'), option: $(this).data('options') },
            dataType: 'json',
            success: function (res) {
                if (res == 1 || res == 2) {
                    $('.list-cart').load('module/mitc');
                    $('#checkout').load('module/icart');
                    return;
                } else if (res == 3) {
                    $('.list-cart').load('module/mitc');
                    $('#checkout').load('module/icart');
                    AwToast('info', 'Đã xóa sản phẩm khỏi giỏ hàng!', 5000);
                    return;
                }
                else {
                    $('.list-cart').load('module/mitc');
                    $('#checkout').load('module/icart');
                    alert("Sản phẩm vượt quá số lượng cho phép!")
                }
                
            }
        })
    })
})


//mouse - click


$(document).ready(function () {
    $('#thanh-toan').click(function (e) {
        e.preventDefault();
        if ($('#email').val() == null || $('#email').val() == '') {
            Swal.fire('Vui lòng nhập email!');
            return false;
        } else if (($('#address').val().trim() == null || $('#address').val().trim() == '')) {
            Swal.fire('Vui lòng nhập địa chỉ nhân hàng!');
            return false;
        }
        $.ajax({
            url: "/cart/checkauth",
            type: 'POST',
            success: function (f) {
                if (f.f == 0) {
                    WIYN();
                } else {
                    $.ajax({
                        url: "/cart/payment",
                        type: 'POST',
                        data: {
                            Email: $('input[name=Email]').val(),
                            Phone: $('input[name=Phone]').val(),
                            Address: $('input[name=Address]').val(),
                            FullName: $('input[name=FullName]').val(),
                        },
                        dataType: 'json',
                        success: function (pig) {
                            if (!pig) {
                                console.log(pig);
                            } else {
                                window.location.href = "account/order";
                            }
                        }
                    })
                }
            }
        })
    })
});


